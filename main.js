(()=>{"use strict";function t(t){t.classList.add("popup_opened"),document.addEventListener("keydown",n)}function e(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",n)}function n(t){"Escape"===t.key&&e(document.querySelector(".popup_opened"))}var r=document.querySelector(".popup_type_server-error"),o=document.querySelector(".server-error__message");function c(e){o.textContent=e,t(r)}var a="https://nomoreparties.co/v1/",u="plus-cohort-4",i="590940f5-109a-4e3f-877b-dbdaff7dcb8c";function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return fetch("".concat(a+u,"/").concat(t),{method:e,headers:{authorization:i,"Content-Type":"application/json"},body:n}).then((function(t){return t.ok?t.json():Promise.reject("".concat(t.status,": ").concat(t.statusText))}))}function d(t,e){t.querySelector(".card__like-counter").textContent=e.likes.length}function s(t,e){var n=t.querySelector(".card__like-button"),r=t.querySelector(".card__like-counter");e.likes.length>0?(n.classList.add("card__like-button_counter-shown"),r.classList.add("card__like-counter_shown"),d(t,e)):(n.classList.remove("card__like-button_counter-shown"),r.classList.remove("card__like-counter_shown"),d(t,e))}var _=document.querySelector(".popup_type_delete-card"),f=_.querySelector(".popup__accept-button");function p(t){var n,r=t.currentTarget;(n=r.cardId,l("cards/".concat(n),"DELETE")).then((function(){r.card.remove(),e(_)})).catch(c)}var v,m=document.querySelector("#photo-card-template").content,y=document.querySelector(".popup_type_full-photo"),S=y.querySelector(".full-photo__photo"),h=y.querySelector(".full-photo__name");function q(t,e){return t.classList.contains(e)}function E(e,n){var r=m.querySelector(".card").cloneNode(!0),o=r.querySelector(".card__photo"),a=r.querySelector(".card__photo-name");return o.src=e.link,o.alt="фотография - ".concat(e.name),a.textContent=e.name,function(t,e,n){var r=t.querySelector(".card__like-button");e.likes.forEach((function(t){t._id===n&&r.classList.add("card__like-button_active")})),d(t,e)}(r,e,n),s(r,e),e.owner._id===n&&function(e,n){var r=document.createElement("button");r.classList.add("card__trash-button","page__button","page__button_style_transparent"),r.addEventListener("click",(function(){f.removeEventListener("click",p),f.cardId=n,f.card=e,f.addEventListener("click",p),t(_)})),e.appendChild(r)}(r,e._id),r.addEventListener("click",(function(n){var u=n.target;q(u,"card__photo")?function(e,n){S.src="",S.src=e.src,S.alt=e.alt,h.textContent=n.textContent,t(y)}(o,a):q(u,"card__like-button")&&function(t,e,n){var r;t.classList.contains("card__like-button_active")?(r=n._id,l("cards/likes/".concat(r),"DELETE")).then((function(n){t.classList.remove("card__like-button_active"),s(e,n)})).catch(c):function(t){return l("cards/likes/".concat(t),"PUT")}(n._id).then((function(n){t.classList.add("card__like-button_active"),s(e,n)})).catch(c)}(u,r,e)})),r}var b=document.querySelector(".profile__edit-button"),L=document.querySelector(".popup_type_edit-profile"),k=L.querySelector(".form"),g=k.querySelector(".form__input_type_name"),C=k.querySelector(".form__input_type_additional-info"),x=document.querySelector(".profile__name"),T=document.querySelector(".profile__additional-info"),w=document.querySelector(".profile__add-button"),A=document.querySelector(".popup_type_add-card"),D=A.querySelector(".form"),P=D.querySelector(".form__input_type_photo-name"),N=D.querySelector(".form__input_type_photo-link"),O=document.querySelector(".profile__change-avatar-button"),j=document.querySelector(".popup_type_change-avatar"),J=j.querySelector(".form"),B=J.querySelector(".form__input_type_change-avatar"),H=document.querySelector(".profile__avatar"),I=document.querySelector(".profile__additional-info"),z=document.querySelector(".profile__avatar"),G=document.querySelector(".cards__list"),M=".form__save-button";k.addEventListener("submit",(function(t){t.preventDefault();var n,r,o=t.currentTarget.querySelector(M),a=o.textContent;o.textContent="Сохранение...",(n=g.value,r=C.value,l("users/me","PATCH",JSON.stringify({name:n,about:r}))).then((function(t){x.textContent=t.name,T.textContent=t.about,e(L)})).catch(c).finally((function(){o.textContent=a}))})),D.addEventListener("submit",(function(t){t.preventDefault();var n,r,o=t.currentTarget.querySelector(M),a=o.textContent;o.textContent="Сохранение...",(n=P.value,r=N.value,l("cards","POST",JSON.stringify({name:n,link:r}))).then((function(t){G.prepend(E(t,v)),e(A)})).catch(c).finally((function(){o.textContent=a}))})),J.addEventListener("submit",(function(t){t.preventDefault();var n=t.currentTarget.querySelector(M),r=n.textContent;n.textContent="Сохранение...",function(t){return l("users/me/avatar","PATCH",JSON.stringify({avatar:t}))}(B.value).then((function(t){H.src=t.avatar,e(j)})).catch(c).finally((function(){n.textContent=r}))})),b.addEventListener("click",(function(){k.reset(),k.querySelector(M).disabled=!1,g.value=x.textContent,C.value=T.textContent,t(L)})),w.addEventListener("click",(function(){D.reset(),t(A)})),O.addEventListener("click",(function(){J.reset(),t(j)})),function(t){function e(e){return Array.from(e.querySelectorAll(t.inputSelector))}function n(e){return e.querySelector(t.submitButtonSelector)}function r(e){e.classList.remove(t.inputErrorClass)}function o(o){var c=o.currentTarget;!function(e,n){!function(t,e){t.querySelector(".".concat(e.id,"-error")).textContent=e.validationMessage}(e,n),function(e){!function(t){return t.validity.valid}(e)?function(e){e.classList.add(t.inputErrorClass)}(e):r(e)}(n)}(c,o.target),function(t){var r=n(t);!function(t){return e(t).some((function(t){return!t.validity.valid}))}(t)?r.disabled=!1:r.disabled=!0}(c)}function c(o){var c=o.currentTarget;!function(t){n(t).disabled=!0}(c),function(e){e.querySelectorAll(t.errorSpanSelector).forEach((function(t){t.textContent=""}))}(c),function(t){e(t).forEach((function(t){r(t)}))}(c)}Array.from(document.forms).forEach((function(t){t.addEventListener("input",o),t.addEventListener("reset",c)}))}({inputSelector:".form__input",errorSpanSelector:".form__validation-error",submitButtonSelector:M,inputErrorClass:"form__input_invalid"}),l("users/me").then((function(t){x.textContent=t.name,I.textContent=t.about,z.src=t.avatar,v=t._id,l("cards").then((function(t){t.reverse().forEach((function(t){G.prepend(E(t,v))}))})).catch(c)})).catch(c),function(){var t=!1;function n(t){t.removeEventListener("mouseup",r)}function r(t){var r=t.currentTarget;t.target===r?(e(r),n(r)):n(r)}function o(e){t=!0;var n=e.currentTarget;e.target===n&&n.addEventListener("mouseup",r)}function c(n){var r=n.currentTarget;n.target===r?function(n){t?t=!1:e(n)}(r):n.target.classList.contains("popup__close-button")&&function(t){e(t)}(r)}document.querySelectorAll(".popup").forEach((function(t){t.addEventListener("mousedown",o),t.addEventListener("click",c)}))}()})();