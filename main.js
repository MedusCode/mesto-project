(()=>{"use strict";function e(e){"Escape"===e.key&&n(document.querySelector(".popup_opened"))}function t(t){t.classList.add("popup_opened"),document.addEventListener("keydown",e)}function n(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",e)}var r=document.querySelector(".popup_type_server-error"),o=document.querySelector(".server-error__message");function c(e){var c=document.querySelector(".popup_opened");c&&n(c),o.textContent=e,t(r)}var u="https://nomoreparties.co/v1/",a="plus-cohort-4",i="590940f5-109a-4e3f-877b-dbdaff7dcb8c";function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return fetch("".concat(u+a,"/").concat(e),{method:t,headers:{authorization:i,"Content-Type":"application/json"},body:n}).then((function(e){return e.ok?e.json():Promise.reject("".concat(e.status,": ").concat(e.statusText))})).catch(c)}function d(e,t){e.querySelector(".card__like-counter").textContent=t.likes.length}function s(e,t){var n=e.querySelector(".card__like-button"),r=e.querySelector(".card__like-counter");t.likes.length>0?(n.classList.add("card__like-button_counter-shown"),r.classList.add("card__like-counter_shown"),d(e,t)):(n.classList.remove("card__like-button_counter-shown"),r.classList.remove("card__like-counter_shown"),d(e,t))}var _=document.querySelector(".popup_type_delete-card"),p=_.querySelector(".popup__accept-button");function f(e){var t,r=e.currentTarget;(t=r.cardId,l("cards/".concat(t),"DELETE")).then((function(){r.card.remove(),n(document.querySelector(".popup_opened"))}))}var v=document.querySelector("#photo-card-template").content,m=document.querySelector(".popup_type_full-photo");function y(e,t){return e.classList.contains(t)}function S(e,n){var r=v.querySelector(".card").cloneNode(!0),o=r.querySelector(".card__photo"),c=r.querySelector(".card__photo-name");return o.src=e.link,o.alt="фотография - ".concat(e.name),c.textContent=e.name,function(e,t,n){var r=e.querySelector(".card__like-button");t.likes.forEach((function(e){e._id===n&&r.classList.add("card__like-button_active")})),d(e,t)}(r,e,n),s(r,e),e.owner._id!==n&&n||function(e,n){var r=document.createElement("button");r.classList.add("card__trash-button","page__button","page__button_style_transparent"),r.addEventListener("click",(function(){p.removeEventListener("click",f),p.cardId=n,p.card=e,p.addEventListener("click",f),t(_)})),e.appendChild(r)}(r,e._id),r.addEventListener("click",(function(n){var u=n.target;y(u,"card__photo")?function(e,n){var r=m.querySelector(".full-photo__photo"),o=m.querySelector(".full-photo__name");r.src=e.src,r.alt=e.alt,o.textContent=n.textContent,t(m)}(o,c):y(u,"card__like-button")&&function(e,t,n){var r;e.classList.contains("card__like-button_active")?(r=n._id,l("cards/likes/".concat(r),"DELETE")).then((function(n){e.classList.remove("card__like-button_active"),s(t,n)})):function(e){return l("cards/likes/".concat(e),"PUT")}(n._id).then((function(n){e.classList.add("card__like-button_active"),s(t,n)}))}(u,r,e)})),r}var q=document.querySelector(".profile__name"),h=document.querySelector(".profile__additional-info"),E=document.querySelector(".profile__avatar"),b=document.querySelector(".cards__list"),L=document.querySelector(".profile__edit-button"),k=document.querySelector(".popup_type_edit-profile"),g=k.querySelector(".form"),C=g.querySelector(".form__input_type_name"),x=g.querySelector(".form__input_type_additional-info"),T=document.querySelector(".profile__name"),w=document.querySelector(".profile__additional-info"),A=document.querySelector(".profile__add-button"),D=document.querySelector(".popup_type_add-card"),P=D.querySelector(".form"),N=P.querySelector(".form__input_type_photo-name"),O=P.querySelector(".form__input_type_photo-link"),j=document.querySelector(".profile__change-avatar-button"),J=document.querySelector(".popup_type_change-avatar"),B=J.querySelector(".form"),H=B.querySelector(".form__input_type_change-avatar"),I=document.querySelector(".profile__avatar"),z=document.querySelector(".cards__list"),G=".form__save-button";g.addEventListener("submit",(function(e){e.preventDefault();var t,r,o=e.currentTarget.querySelector(G),c=o.textContent;o.textContent="Сохранение...",(t=C.value,r=x.value,l("users/me","PATCH",JSON.stringify({name:t,about:r}))).then((function(e){T.textContent=e.name,w.textContent=e.about,n(k),o.textContent=c}))})),P.addEventListener("submit",(function(e){e.preventDefault();var t,r,o=e.currentTarget.querySelector(G),c=o.textContent;o.textContent="Сохранение...",(t=N.value,r=O.value,l("cards","POST",JSON.stringify({name:t,link:r}))).then((function(e){z.prepend(S(e)),n(D),o.textContent=c}))})),B.addEventListener("submit",(function(e){e.preventDefault();var t=e.currentTarget.querySelector(G),r=t.textContent;t.textContent="Сохранение...",function(e){return l("users/me/avatar","PATCH",JSON.stringify({avatar:e}))}(H.value).then((function(e){I.src=e.avatar,n(J),t.textContent=r}))})),L.addEventListener("click",(function(){g.reset(),g.querySelector(G).disabled=!1,C.value=T.textContent,x.value=w.textContent,t(k)})),A.addEventListener("click",(function(){P.reset(),t(D)})),j.addEventListener("click",(function(){B.reset(),t(J)})),function(e){function t(e){return Array.from(e.querySelectorAll("input"))}function n(t){return t.querySelector(e.submitButtonSelector)}function r(t){t.classList.remove(e.inputErrorClass)}function o(o){var c=o.currentTarget;!function(t,n){!function(e,t){e.querySelector(".".concat(t.id,"-error")).textContent=t.validationMessage}(t,n),function(t){!function(e){return e.validity.valid}(t)?function(t){t.classList.add(e.inputErrorClass)}(t):r(t)}(n)}(c,o.target),function(e){var r=n(e);!function(e){return t(e).some((function(e){return!e.validity.valid}))}(e)?r.disabled=!1:r.disabled=!0}(c)}function c(o){var c=o.currentTarget;!function(e){n(e).disabled=!0}(c),function(t){t.querySelectorAll(e.errorSpanSelector).forEach((function(e){e.textContent=""}))}(c),function(e){t(e).forEach((function(e){r(e)}))}(c)}Array.from(document.forms).forEach((function(e){e.addEventListener("input",o),e.addEventListener("reset",c)}))}({errorSpanSelector:".form__validation-error",submitButtonSelector:G,inputErrorClass:"form__input_invalid"}),function(){var e=!1;function t(e){e.removeEventListener("mouseup",r)}function r(e){var r=e.currentTarget;e.target===r?(n(r),t(r)):t(r)}function o(t){e=!0;var n=t.currentTarget;t.target===n&&n.addEventListener("mouseup",r)}function c(t){var r=t.currentTarget;t.target===r?function(t){e?e=!1:n(t)}(r):t.target.classList.contains("popup__close-button")&&function(e){n(e)}(r)}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",o),e.addEventListener("click",c)}))}(),l("cards").then((function(e){l("users/me").then((function(e){return e._id})).then((function(t){e.reverse().forEach((function(e){b.prepend(S(e,t))}))}))})),l("users/me").then((function(e){q.textContent=e.name,h.textContent=e.about,E.src=e.avatar}))})();